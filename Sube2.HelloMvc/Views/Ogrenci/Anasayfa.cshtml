@{
    ViewData["Title"] = "Ana Sayfa";
}

<!-- Karşılama Alanı -->
<div class="text-center my-5">
    <h1 class="display-4">Sube2.HelloMvc</h1>
    <p class="lead">Öğrenci Yönetim Sistemine Hoş Geldiniz</p>
    <img src="https://via.placeholder.com/600x200?text=Öğrenci+Yönetim" class="img-fluid rounded my-3" alt="Banner" />
</div>

<!-- İstatistik Kartları -->
<div class="row g-4 mb-5">
    <div class="col-md-4">
        <div class="card text-center p-3">
            <i class="fas fa-users fa-3x text-primary mb-3"></i>
            <h5>Toplam Öğrenci</h5>
            <p id="totalStudents" class="fw-bold">Yükleniyor...</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center p-3">
            <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
            <h5>Bu Ay Eklenen</h5>
            <p id="newThisMonth" class="fw-bold">Yükleniyor...</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center p-3">
            <i class="fas fa-school fa-3x text-primary mb-3"></i>
            <h5>Sınıf Sayısı</h5>
            <p id="classCount" class="fw-bold">Yükleniyor...</p>
        </div>
    </div>
</div>

<!-- Grafikler ve Dairesel Gösterge -->
<div class="row g-4 mb-5">
    <!-- Pasta Grafik -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i> Sınıf Dağılımı</h5>
            </div>
            <div class="card-body">
                <canvas id="classPieChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Çubuk Grafik -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i> Aylık Yeni Öğrenciler</h5>
            </div>
            <div class="card-body">
                <canvas id="monthlyBarChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Dairesel Gösterge -->
    <div class="col-12 text-center">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i> Öğrenci Doluluk Oranı</h5>
            </div>
            <div class="card-body">
                <div class="progress-circle" id="studentProgress">
                    <span class="progress-text">0%</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hızlı Erişim Butonları -->
<div class="text-center mb-5">
    <a href="/Ogrenci/OgrenciEkle" class="btn btn-primary me-2"><i class="fas fa-user-plus me-2"></i> Öğrenci Ekle</a>
    <a href="/Ogrenci/OgrenciListe" class="btn btn-primary"><i class="fas fa-list me-2"></i> Öğrenci Listesi</a>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
    <script>
        $(document).ready(function () {
            // İstatistikleri çek
            $.ajax({
                url: '/Home/GetStatistics',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // Kartları güncelle
                    $('#totalStudents').text(data.totalStudents);
                    $('#newThisMonth').text(data.newThisMonth);
                    $('#classCount').text(data.classDistribution.length);

                    // Pasta Grafik
                    new Chart(document.getElementById('classPieChart'), {
                        type: 'pie',
                        data: {
                            labels: data.classDistribution.map(item => item.class),
                            datasets: [{
                                data: data.classDistribution.map(item => item.count),
                                backgroundColor: ['#007bff', '#28a745', '#dc3545', '#ffc107'],
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { position: 'top' }
                            }
                        }
                    });

                    // Çubuk Grafik
                    new Chart(document.getElementById('monthlyBarChart'), {
                        type: 'bar',
                        data: {
                            labels: data.monthlyAdditions.map(item => item.month),
                            datasets: [{
                                label: 'Yeni Öğrenciler',
                                data: data.monthlyAdditions.map(item => item.count),
                                backgroundColor: '#007bff',
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });

                    // Dairesel Gösterge
                    const maxStudents = 200; // Örnek maksimum kapasite
                    const percentage = (data.totalStudents / maxStudents) * 100;
                    $('#studentProgress').css('background', `conic-gradient(#007bff ${percentage}%, #e9ecef ${percentage}%)`);
                    $('.progress-text').text(Math.round(percentage) + '%');
                },
                error: function (xhr, status, error) {
                    console.log("Hata: " + error);
                    alert('İstatistikler yüklenemedi!');
                }
            });
        });
    </script>
}